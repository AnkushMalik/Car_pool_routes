extends layout

block content
  h1= title
  h2 Enter passengers locations:
  input#locs(type='text', name='locations', placeholder='seprated by commas')
  br
  button#showmap(onclick='pathrenderer') submit
  #googleMap(style='width:100%;height:400px;')

  script(src='https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js')
  script(src='https://maps.googleapis.com/maps/api/js?key=AIzaSyCbzQj2T_M20q6VX7w64q0ZyzO-qKRrj7k&sensor=false')
  script.
    let locs
    let startloc
    let endloc

    function MapLoad() {                 //To initialize google maps
      directionsDisplay = new google.maps.DirectionsRenderer();
      let mapProp = {
        center: new google.maps.LatLng(28.7041,77.1025),//Placing the center of map to New Delhi
        zoom: 11,
        mapTypeId: google.maps.MapTypeId.ROADMAP,
        draggableCursor: 'move'
      };
      let map = new google.maps.Map(document.getElementById("googleMap"),mapProp);
      directionsDisplay.setMap(map);
    }

    function calculateDistance(){ //calculate distance between locations.
      let dms = new google.maps.DistanceMatrixService();
      dms.getDistanceMatrix(
        {
          origins: startloc,
          destinations: locs,
          travelMode: google.maps.TravelMode.DRIVING,
          avoidHighways: false,
          avoidTolls: false
        },function(data, status){
          if status != google.maps.DistanceMatrixStatus.OK{
            alert("Something went wrong :" + status);
          }
          else{
            let routes = data.rows[0]
            let sortedlocs = []
            for(i =routes.elements.length-1; i>=0; i--)
            {
              let routeLength = routes.elements[i].distance.value;
              sortedlocs.push([locs[i],routeLength]);
            }
            let waypoints = [] //https://developers.google.com/maps/documentation/javascript/examples/directions-waypoints
            for(i=0;i<sortedlocs.length-1;i++)
            {
              waypoints.push({
                location: sortedlocs[i][0],
                stopover: true
              });
            }
            endloc = sortedlocs[sortedlocs.length-1][0];
            routeMapper(startloc,endloc,waypoints)
          }
        });           
    }

    function routeMapper(start,end,wp){ // Now Map points as per distance  ontained
    }
    
    function Pathrenderer(){
      locs = $('#locs').val().split(',');
      startloc = locs[0];
      calculateDistance(); //calculate distance between locations and map route accordingly.
    }

    //- $('#showmap').click(function(){
      
    //-   calcDis();  
    //- });

    google.maps.event.addDomListener(window, 'load', MapLoad); 
    
    
